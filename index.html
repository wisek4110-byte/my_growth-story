<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>continue in what you have inside</title>
    <style>
        /* --- [ìˆ˜ì •] ë¡œì»¬ í°íŠ¸ íŒŒì¼ ì—°ê²° --- */
        
        /* ê¸°ë³¸ í°íŠ¸: YES24MyoungjoR.ttf */
        @font-face {
            font-family: 'YES24';
            src: url('YES24MyoungjoR.ttf') format('truetype'); 
            font-weight: normal;
            font-style: normal;
        }
        
        /* íŠ¸ë¼ìš°ë§ˆ í°íŠ¸: YEONGNAMNEWS_Ku_Sang.ttf */
        @font-face {
            font-family: 'YNAMNEWS'; 
            src: url('YEONGNAMNEWS_Ku_Sang.ttf') format('truetype');
            font-weight: bold;
            font-style: normal;
        }

        :root {
            --bg-lightness: 5%;
            --base-bg-color: hsl(0, 0%, var(--bg-lightness));
            --text-color: #f0f0f0;
            --accent-red: #ff3333;
            --transition-speed: 1.5s;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            font-family: 'YES24', 'Malgun Gothic', sans-serif; /* ê¸°ë³¸ í°íŠ¸ ì ìš© */
            background-color: var(--base-bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100dvh;
            overflow: hidden;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        #game-container {
            width: 100%;
            max-width: 800px;
            height: 90vh;
            position: relative;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--text-color);
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            overflow: hidden;
            transition: border-color var(--transition-speed);
        }

        @media (max-width: 768px) {
            #game-container {
                max-width: 100%;
                height: 100dvh;
                border: none;
                border-radius: 0;
            }
            .dialogue { font-size: 1.1rem !important; line-height: 1.6 !important; }
            #choice-container { padding: 20px !important; min-height: 140px; }
            .btn { padding: 16px !important; font-size: 1rem !important; }
        }

        /* ë°°ê²½ ì´ë¯¸ì§€ ë ˆì´ì–´ */
        #bg-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            filter: blur(5px);
            z-index: 0;
            transition: opacity 0.5s ease-in-out;
        }

        #ui-layer {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            height: 100%;
            background: rgba(0,0,0,0.02);
            width: 100%;
        }

        #status-bar {
            padding: 15px 20px;
            border-bottom: 1px solid var(--text-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95rem;
            transition: border-color var(--transition-speed);
            flex-shrink: 0;
        }

        #display-area {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            width: 100%;
        }

        .dialogue {
            font-size: 1.3rem;
            line-height: 1.8;
            white-space: pre-wrap;
            animation: fadeIn 0.8s ease-in;
            word-break: keep-all;
            text-shadow: 0 0 8px rgba(0,0,0,0.8);
            max-width: 90%;
        }

        /* íŠ¸ë¼ìš°ë§ˆ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .trauma-word {
            position: absolute;
            font-family: 'YNAMNEWS', serif; /* íŠ¸ë¼ìš°ë§ˆ í°íŠ¸ ì ìš© */
            font-weight: bold;
            pointer-events: none;
            opacity: 0;
            animation: glitchPop 0.15s forwards;
            z-index: 20;
            white-space: nowrap;
        }
        
        .trauma-red {
            color: var(--accent-red) !important;
            text-shadow: 2px 2px 0px #000;
        }

        .bad-end-line {
            opacity: 0;
            margin: 10px 0;
            font-weight: bold;
            animation: slideUpFade 1.5s forwards;
        }
        
        .normal-end-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 20px;
            display: block;
            color: inherit;
        }

        #choice-container {
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 120px;
            justify-content: center;
            background: linear-gradient(to top, rgba(0,0,0,0.5) 0%, transparent 100%);
            flex-shrink: 0;
            width: 100%;
        }

        .btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--text-color);
            color: var(--text-color);
            padding: 15px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s;
            border-radius: 8px;
            backdrop-filter: blur(2px);
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            -webkit-tap-highlight-color: transparent;
            font-family: 'YES24', sans-serif; /* ë²„íŠ¼ì—ë„ í°íŠ¸ ì ìš© */
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }
        
        .btn:active { transform: scale(0.98); }

        /* ë‹¤ìŒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .next-btn {
            border: none;
            font-style: italic;
            text-align: right;
            padding-right: 30px;
            background: transparent;
            margin-left: auto;
            width: auto;
            /* ìê°„ ë³€í™” ë¶€ë“œëŸ½ê²Œ */
            transition: letter-spacing 0.3s ease; 
        }

        /* ë‹¤ìŒ ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼: ìƒ‰ìƒì€ ê·¸ëŒ€ë¡œ, ìê°„ë§Œ ë„“ì–´ì§ */
        .next-btn:hover {
            letter-spacing: 5px; /* ìê°„ í™•ì¥ */
            background: transparent;
            transform: none;
        }

        #notif {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-color);
            color: var(--base-bg-color);
            padding: 10px 30px;
            border-radius: 30px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 100;
            pointer-events: none;
            white-space: nowrap;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .show-notif { opacity: 1 !important; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUpFade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes glitchPop { 
            0% { transform: scale(0.5) skew(10deg); opacity: 0; } 
            50% { transform: scale(1.1) skew(-10deg); opacity: 1; }
            100% { transform: scale(1) skew(0deg); opacity: 0.9; } 
        }

    </style>
</head>
<body>

<div id="game-container">
    <div id="bg-layer"></div>
    <div id="ui-layer">
        <div id="status-bar">
            <span>ë‚´ë©´ì˜ ì„±ì¥</span>
            <span id="growth-stage">ğŸŒ° ì”¨ì•— (0)</span>
        </div>
        <div id="notif">ì•Œë¦¼</div>
        <div id="display-area">
            <div id="dialogue-text" class="dialogue"></div>
        </div>
        <div id="choice-container"></div>
    </div>
</div>

<script>
    // --- ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì • ---
    // ê°™ì€ í´ë”ì— ì´ë¯¸ì§€ íŒŒì¼(baby.png ë“±)ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
    const bgImages = {
        "baby": "baby.png", 
        "malice": "https://placehold.co/800x600/220000/red?text=Malice",
        "suffering": "https://placehold.co/800x600/000/red?text=Trauma",
        "bad_teacher": "https://placehold.co/800x600/444/fff?text=Teacher+Classroom",
        "book": "https://placehold.co/800x600/3e2723/fff?text=Library+Books",
        "crossroad": "https://placehold.co/800x600/555/eee?text=Crossroad",
        "wandering": "https://placehold.co/800x600/444/888?text=Wandering",
        "school_librarian1": "https://placehold.co/800x600/dcedc8/33691e?text=New+Librarian",
        "school_librarian2": "https://placehold.co/800x600/aed581/33691e?text=Vibrant+Library"
    };

    let currentScore = 0;
    let traumaInterval = null;
    let checkpoint = { sceneId: 'start', score: 0 };

    function getStageName(s) {
        if (s >= 60) return "ğŸŒ² ìˆ²";
        if (s >= 40) return "ğŸŒ³ ë‚˜ë¬´";
        if (s >= 30) return "ğŸŒ¸ ê½ƒ";
        if (s >= 25) return "ğŸŒ¿ í’€";
        if (s >= 15) return "ğŸŒ± ìƒˆì‹¹";
        return "ğŸŒ° ì”¨ì•—";
    }

    const scenes = {
        "start": { text: "ì—¬ê¸°, í•œ ì•„ì´ê°€ ì„¸ìƒì— íƒœì–´ë‚¬ë‹¤.", bg: "baby", next: "2" },
        "2": { text: "ì•„ì´ëŠ” ë¶€ëª¨ ë°‘ì—ì„œ ë¨¹ê³ , ìë¼ê³ , ë°°ì›Œê°€ë©°.... ì‚¬íšŒì˜ ì¼ì›ì´ ë˜ê¸¸ìœ„í•œ ì¤€ë¹„ë¥¼ í•´ ë‚˜ê°„ë‹¤.", next: "3" },
        "3": { text: "ê·¸ëŸ¬ë‚˜ ì„¸ìƒì€ ì•„ì´ì—ê²Œ ë„ˆë¬´ë‚˜ë„ ì°¨ê°‘ê³  ëƒ‰í˜¹í–ˆë‹¤.", next: "4" },
        "4": { text: "ì•„ì´: \"ì €, ì €ê¸°....\"", next: "malice_start" },
        "malice_start": { text: "ì•„ì´ë¥¼ ê´´ë¡­íˆëŠ” ê·¼ê±°ì—†ëŠ” ì•…ì˜ë“¤ì´ ê³„ì†í•´ì„œ ìŸì•„ì§„ë‹¤...", bg: "malice", next: "trauma_start" },
        "trauma_start": { text: "", bg: "suffering", type: "start_trauma", next: "violence", autoText: " " },
        "violence": { text: "ì–´ë–¤ ì•„ì´ê°€ ì•„ì´ì˜ ë¨¸ë¦¬ë¥¼ í½ ì¹˜ê³  ë„ë§ê°„ë‹¤.\n\n\"ë©~ì²­ì´!\"", type: "stop_trauma", next: "silence" },
        "silence": { text: "ì•„ì´: \".......\"", next: "wither" },
        "wither": { text: "ì•„ì´ëŠ” ì ì  ìœ„ì¶•ë˜ì–´ê°„ë‹¤. í˜¼ì ë°©ì— ë“¤ì–´ê°€ ì¡°ìš©íˆ ë² ê°œë¥¼ ì ì‹œëŠ” ì¼ì´ ë§ì•„ì§„ë‹¤.", next: "cry" },
        "cry": { text: "ì•„ì´: \"í‘í‘... ì—„ë§ˆì•„....\"", next: "choice_mom" },
        "choice_mom": {
            text: "ì—„ë§ˆ: \"ì•„, ì•„ê°€... ë¬´ìŠ¨ ì¼ì´ì•¼? ì™œ ê·¸ë˜?\"",
            isChoice: true,
            choices: [
                { text: "ê°€ë§Œíˆ ë„ë¦¬ì§ˆì„ ì¹œë‹¤.", next: "bad_mom" },
                { text: "í•™êµì—ì„œ ìˆì—ˆë˜ ì¼ì„ ë§í•œë‹¤.", next: "mom_help", score: 1 }
            ]
        },
        "bad_mom": {
            lines: [
                "ì•„ì´ë¥¼ í–¥í•œ ê´´ë¡­í˜ì€ ì ì  ë„ë¥¼ ë„˜ëŠ”ë‹¤.",
                "ê·¸ëŸ¬ë‚˜ ì•„ì´ë¥¼ ì§€ì¼œì£¼ëŠ” ì´ëŠ” ì•„ë¬´ë„ ì—†ë‹¤.",
                "ê·¸ë ‡ê²Œ ì–´ë¥¸ìœ¼ë¡œ ìë€ë‹¤.",
                "ì•„ì´ëŠ” ìš°ìš¸ì¦ì´ ì ì  ì‹¬í•´ì„œ ê²°êµ­ì€ ì„¸ìƒì„ ë“±ì§€ê²Œëœë‹¤.",
                "<br><b style='color:var(--accent-red)'>[Bad End: ì„¸ìƒì€ ì§€ì˜¥ì´ë‹¤]</b>"
            ],
            isBadEnd: true
        },
        "mom_help": { text: "ì—„ë§ˆ: \"ê´œì°®ì•„. ê´œì°®ì•„. ì—„ë§ˆê°€ ë„ì™€ì¤„ê²Œ.\"", next: "mom_action" },
        "mom_action": { text: "ì•„ì´ì˜ ì—„ë§ˆëŠ” í•™êµë¡œ ì°¾ì•„ê°€ ë‹´ì„ì„ ìƒì„ ë§Œë‚œë‹¤.", next: "not_alone" },
        "not_alone": { text: "ì•„ì´ëŠ” ì²˜ìŒìœ¼ë¡œ í˜¼ìê°€ ì•„ë‹˜ì„ ëŠë‚€ë‹¤.", next: "mom_request" },
        "mom_request": { text: "ì—„ë§ˆëŠ” ë°˜ì˜ ì•„ì´ë“¤ì„ ì°¾ì•„ê°€ì„œ ìì‹ ì˜ ì•„ì´ì™€ ì‚¬ì´ì¢‹ê²Œ ì§€ë‚´ì£¼ê¸¸ ê°„ê³¡íˆ ë¶€íƒí•œë‹¤.", next: "no_change" },
        "no_change": { text: "ê·¸ëŸ¬ë‚˜ ìƒí™©ì´ í¬ê²Œ ë‚˜ì•„ì§€ì§„ ì•Šì•˜ë‹¤.", next: "worse" },
        "worse": { text: "ì´ì „ì—” ëŒ€ë†“ê³  ìˆì—ˆë˜ ê´´ë¡­í˜ì€ ì ì  ë” êµë¬˜í•´ì ¸, ì–´ë¥¸ë“¤ì˜ ëˆˆì´ ë‹¿ì§€ ì•ŠëŠ” ê³³ì—ì„œ ê·¸ ì†ê¸¸ì„ ë»—ì³¤ë‹¤.", next: "choice_teacher" },
        
        "choice_teacher": {
            text: "ì„ ìƒ: \"XXì•„, ì¹œêµ¬ë‘ ëŒ€í™”ë¥¼ í•´ì•¼ì§€. ê·¸ë ‡ê²Œ í˜¼ìë‹¤ë‹ˆë©´ ì•ˆ ë¼.\"\n\nì•„ì´: \".......\"",
            bg: "bad_teacher",
            isChoice: true,
            choices: [
                { text: "ë‹¤ë¥¸ í•™êµë¡œ ì „í•™ì„ ê°„ë‹¤.", next: "bad_run" },
                { text: "ê·¸ì € ì°¸ëŠ”ë‹¤.", next: "bad_patience" },
                { text: ".......", next: "revenge_thought" }
            ]
        },

        "bad_run": {
            lines: [
                "ê·¸ë“¤ì„ í”¼í•´ ë©€ë¦¬ ë„ë§ê°€ëŠ” ê²ƒë„ í•˜ë‚˜ì˜ ë°©ë²•ì¼ ê²ƒì´ë‹¤.",
                "í•˜ì§€ë§Œ, ê·¸ë ‡ë‹¤ë©´ ì´ì•¼ê¸°ëŠ” ê³„ì† ì´ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤.",
                "<br><b style='color:var(--accent-red)'>[Bad End: ì˜ì›í•œ ë„í”¼]</b>"
            ],
            isBadEnd: true
        },
        "bad_patience": {
            lines: [
                "ì•„ì´ëŠ” ê·¸ì € ì°¸ëŠ”ë‹¤. ì°¸ê³ , ì°¸ê³ , ë˜ ì°¸ëŠ”ë‹¤.",
                "ì°¸ìœ¼ë©´... ë­ ë¼?",
                "<br><b style='color:var(--accent-red)'>[Bad End: í™”ë³‘]</b>"
            ],
            isBadEnd: true
        },
        "revenge_thought": { text: "ì•„ì´ëŠ” ëŒ€ë‹µí•˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë ‡ì§€ë§Œ, ì•„ì´ì˜ ë§ˆìŒ ì†ì—ëŠ” ë¬´ì–¸ê°€ê°€ í•œ ê°€ì§€ì˜ ê°ì •ì´ ë– ì˜¤ë¥¸ë‹¤.", next: "revenge_word" },
        "revenge_word": { text: "\"ë³µìˆ˜\"", next: "revenge_will" },
        "revenge_will": { text: "\"ë‚˜ëŠ” ì €ë“¤ì—ê²Œ ë³µìˆ˜í•  ê²ƒì´ë‹¤.\"", next: "revenge_action" },
        "revenge_action": { text: "\"ì €ë“¤ì„ ì² ì €íˆ ì§“ë°Ÿê³  ì˜¬ë¼ì„¤ ê²ƒì´ë‹¤.\"", score: -2, next: "nature" }, 
        "nature": { text: "ê·¸ëŸ¬ë‚˜, ì•„ì´ëŠ” ì²œì„±ì´ ê·¸ë¦¬ ëª¨ì§ˆì§€ ëª»í–ˆë‹¤.", next: "wall" },
        "wall": { text: "ê²°êµ­ ì•„ì´ê°€ ì„ íƒí•œ ë°©ë²•ì€ íƒ€ì¸ì„ ì² ì €íˆ ë°°ì œí•˜ê³ , ì˜ì‹¬í•˜ê³ , ë©€ì–´ì§€ê³ , ë²½ì„ ì¹˜ëŠ” ê²ƒì´ì—ˆë‹¤.", next: "friend_book" },
        "friend_book": { text: "ê·¸ë˜ë„, ì•„ì´ì—ê² ë‚˜ë¦„ì˜ ì¹œêµ¬ê°€ ìˆì—ˆë‹¤.", next: "book_is" },
        "book_is": { text: "ê·¸ê²ƒì€ ë°”ë¡œ ã€Œì±…ã€ì´ì—ˆë‹¤.", bg: "book", next: "book_world" },
        
        "book_world": { 
            text: "ì±… ì†ì˜ ì„¸ìƒì€ í¬ë§ì°¨ê³ , ì¦ê±°ìš°ë©°, ì•„ì´ì˜ ìƒìƒë ¥ì„ ìê·¹í–ˆë‹¤.", 
            score: 2, 
            next: "grow_wall" 
        },
        
        "grow_wall": { text: "ì•„ì´ëŠ” ê·¸ë ‡ê²Œ ì„¸ìƒê³¼ëŠ” ë²½ì„ ì¹œ ì±„, ì±… ì†ì˜ ì´ì•¼ê¸°ë§Œì„ ê°ˆêµ¬í•˜ë©° ìë¼ê°„ë‹¤.", next: "highschool" },
        "highschool": { text: "ì•„ì´ëŠ” ì–´ëŠë§ìë¼ ê³ ë“±í•™ìƒì´ ë˜ì—ˆë‹¤.", next: "volunteer" },
        "volunteer": { text: "ê³ ë“±í•™êµì—ì„œëŠ” ë´‰ì‚¬ì ìˆ˜ë¥¼ ì±„ì›Œì•¼ ì¡¸ì—…ì„ í•  ìˆ˜ ìˆì—ˆë‹¤.", next: "library_club" },
        "library_club": { text: "ì•„ì´ëŠ” ê³ ë¯¼í•˜ë‹¤ í‰ì†Œì— ì±…ì„ ì¢‹ì•„í•˜ê¸°ë„ í•˜ê³  í° í™œë™ì—†ì´ë„ ë´‰ì‚¬ì ìˆ˜ë¥¼ ì±„ìš¸ ìˆ˜ ìˆëŠ” 'ë„ì„œë¶€'ì— ë“¤ì–´ê°€ê²Œ ëœë‹¤.", next: "library_peace" },
        "library_peace": { text: "í•™êµ ë„ì„œê´€ì€ ì•„ì´ì—ê²Œ í‰ì•ˆì„ ì£¼ëŠ” ê³³ì´ì—ˆë‹¤.", next: "library_rest" },
        "library_rest": { text: "ë§ˆìŒì— ì‰¼ì„ ì£¼ê¸°ë„í•˜ê³ , ë”±íˆ ëˆ„êµ°ê°€ì˜ ëˆˆì¹˜ë¥¼ ë³´ì§€ ì•Šì•„ì„œ ê·¸ê²ƒì´ ê°€ì¥ ì¢‹ì•˜ë‹¤.", next: "library_books" },
        "library_books": { text: "ê·¸ë¦¬ê³  ì¢‹ì•„í•˜ëŠ” ì±…ì„ ë§ˆìŒê» ë³¼ ìˆ˜ ìˆëŠ” ê²ƒë„ ì¥ì ì´ì—ˆë‹¤.", next: "senior_year" },
        "senior_year": { text: "ê·¸ë¦¬ê³  ê³ 3ì´ ë˜ì—ˆë‹¤.", next: "conflict" },
        "conflict": { 
            text: "ì•„ì´ëŠ” ì±… ì†ì˜ ì„¸ê³„ì— ì¹¨ì í•˜ê³  ì‹¶ì—ˆë‹¤.\nê·¸ëŸ¬ë‚˜ ì•„ì´ì˜ ë¶€ëª¨ëŠ” ë‚¨ë“¤ì²˜ëŸ¼ ëŒ€í•™ì„ ê°€ê³  ì‚¬íšŒì— ë‚˜ê°€ê¸¸ ì›í–ˆë‹¤.\n\nê·¸ë¦¬ê³  ì‚¬íšŒê°€ ê·¸ë ‡ê²Œ ì›í–ˆë‹¤.", 
            next: "crossroad_scene" 
        },
        "crossroad_scene": {
            text: "ê²°êµ­, ì•„ì´ëŠ” ì§„ë¡œë¼ëŠ” ì²« ë²ˆì§¸ ê±°ëŒ€í•œ ê°ˆë¦¼ê¸¸ì— ë†“ì˜€ë‹¤.",
            bg: "crossroad",
            score: 1, 
            next: "inner_voice_1" 
        },
        "inner_voice_1": {
            text: "â€˜í•˜ì§€ë§Œ, ë‚œ ë­˜ í•´ì•¼í•˜ì§€?â€™\n\nì–´ë¥¸ë“¤ì€ ì•„ì´ì—ê²Œ ì¸ìƒì— ëŒ€í•´ ê¹Šì´ ê°€ë¥´ì³ì£¼ì§€ ëª»í–ˆë‹¤.\nì–´ë–¤ ëª©í‘œë¥¼ ê°€ì ¸ì•¼ í•˜ê³ , ë¬´ì—‡ì„ ì¢‹ì•„í•˜ê³ , ì™œ ì¸ìƒì„ ì‚´ì•„ì•¼í•˜ëŠ”ì§€.",
            next: "inner_voice_2"
        },
        "inner_voice_2": {
            text: "ì•„ì´ì˜ ë¶€ëª¨ì¡°ì°¨ ì•Œë ¤ì£¼ì§€ ì•Šì•˜ë‹¤.\nì–´ë¥¸ë“¤ì€ ê·¸ì € â€œì„±ê³µí•œâ€ì¸ìƒë§Œ ì£¼ì…í–ˆë‹¤.",
            next: "inner_voice_3"
        },
        "inner_voice_3": {
            text: "ê·¸ê²ƒì´ ì§„ì •ìœ¼ë¡œ â€œí–‰ë³µâ€í•œ ê¸¸ì´ë¼ê³ .",
            next: "choice_career"
        },
        "choice_career": {
            text: "â€˜ë‚œâ€¦â€™",
            bg: "crossroad",
            isChoice: true,
            choices: [
                { text: "ê·¸ëƒ¥ ì„±ì ì— ë§ëŠ” ê³¼ë¥¼ ì„ íƒí•œë‹¤.", next: "conformity_1" },
                { text: "ì¡°ê¸ˆë§Œ ë” ìƒê°í•´ ë³¸ë‹¤.", next: "thinking_life" }
            ]
        },

        // 3-1
        "conformity_1": {
            text: "â€œì–´ì°¨í”¼ ë‚˜ëŠ” íŠ¹ë³„íˆ ì˜ í•˜ëŠ” ê²ƒë„â€¦ ì¢‹ì•„í•˜ëŠ” ê²ƒë„ ì—†ëŠ” ê±¸.â€\n\nê·¸ì € ë¶€ëª¨ê°€ ì›í•˜ëŠ”ëŒ€ë¡œ, ì‚¬íšŒê°€ ì›í•˜ëŠ”ëŒ€ë¡œâ€¦.\nê·¸ëŸ¬ë©´ â€œí–‰ë³µâ€í• ê¹Œ?",
            next: "conformity_2"
        },
        "conformity_2": {
            text: "ì•„ì´ëŠ” ìì‹ ì˜ ì„±ì ì— ë§ì¶° ì ë‹¹í•œ ê³¼ë¥¼ ì§€ì›í•˜ì—¬ í•©ê²©í–ˆë‹¤.\nê·¸ê³³ì—ì„œ ì¡°ìš©íˆ ë‹¤ë‹ˆë©° ì–´ì°Œì €ì§€ ì¡¸ì—…í–ˆë‹¤.",
            next: "end_wandering"
        },
        "end_wandering": {
            text: "ê·¸ëŸ¼ì—ë„ ì—¬ì „íˆ í—¤ë§¤ê³  ìˆë‹¤. ìì‹ ì´ ëˆ„êµ¬ì¸ì§€ë„ ëª¨ë¥¸ ì±„â€¦\n<span class='normal-end-title'>[End1: ì´ ë˜í•œ ì‚¶ì´ë¦¬ë¼]</span>",
            bg: "wandering",
            next: null
        },

        // 3-2
        "thinking_life": {
            text: "â€˜ì³‡ë°”í€´ì²˜ëŸ¼ ë„ëŠ” ì¸ìƒì´ ì •ë§ ì¸ìƒì˜ ì „ë¶€ì¼ê¹Œ?â€™\n\nì•„ì´ëŠ” ê³ ë¯¼í–ˆë‹¤.",
            next: "seeking_happiness"
        },
        "seeking_happiness": {
            text: "ê·¸ë¦¬ê³  ì•„ì´ëŠ” ë‚˜ë¦„ì˜ â€œí–‰ë³µâ€ì„ ì°¾ê³  ì‹¶ì—ˆë‹¤.",
            score: 2,
            next: "still_lost"
        },
        "still_lost": {
            text: "í•˜ì§€ë§Œ, ì—¬ì „íˆ ë¬´ì—‡ì„ í•´ì•¼í•  ì§„ ê°ˆí”¼ë¥¼ ì¡ì§€ ëª»í•˜ê³  ìˆì—ˆë‹¤.",
            next: "new_librarian"
        },
        "new_librarian": {
            text: "ê·¸ëŸ¬ë˜ ì¤‘ í•™êµ ë„ì„œê´€ì— ìƒˆë¡œìš´ ì‚¬ì„œ ì„ ìƒë‹˜ì´ ì˜¤ì…¨ë‹¤.",
            bg: "school_librarian1",
            next: "librarian_effect"
        },
        "librarian_effect": {
            text: "ì‚¬ì„œ ì„ ìƒë‹˜ì€ ì´ì „ì— í•™ìƒë“¤ë§Œ ëŒ€ì¶© ê´€ë¦¬í•˜ë˜ ë„ì„œê´€ì— í™œê¸°ë¥¼ ë¶ˆì–´ë„£ì—ˆê³ , ë„ì„œê´€ì„ ë”ìš± ë©‹ì§€ê²Œ ê°€ê¾¸ì–´ ë†“ì•˜ë‹¤.",
            bg: "school_librarian2",
            next: "found_goal"
        },
        "found_goal": {
            text: "ì²˜ìŒìœ¼ë¡œ ì•„ì´ëŠ” ëª©í‘œê°€ ìƒê²¼ë‹¤.\n\nâ€˜ë‚˜ë„ ë‚˜ì¤‘ì— ì €ëŸ° â€œì‚¬ì„œâ€ê°€ ë˜ê³ ì‹¶ì–´.â€™",
            score: 4,
            next: "uni_entry"
        },
        "uni_entry": {
            text: "ì•„ì´ëŠ” ê·¸ë ‡ê²Œ â€œì‚¬ì„œâ€ë¼ëŠ” ì§ì—…ì— ëŒ€í•´ ì•Œì•„ë³´ê³ \në¬¸í—Œì •ë³´í•™ê³¼ì— ì§„í•™í–ˆë‹¤.",
            next: "desert_feeling"
        },
        "desert_feeling": {
            text: "ëŒ€í•™ í•©ê²©ì˜ ê¸°ì¨ë„ ì ì‹œ, ì•„ì´ëŠ” ë‚¯ì„ ë„ì‹œ, ë‚¯ì„ í™˜ê²½, ë¶€ëª¨ê°€ ì—†ëŠ” ë‚¯ì„  ìƒí™©ì— ì–´ì°Œí•  ë°”ë¥¼ ëª°ëë‹¤.\n\nê·¸ì•¼ë§ë¡œ ì‚¬ë§‰ í•œ ê°€ìš´ë°ì— ë–¨ì–´ì§„ ë“¯í•œ ê¸°ë¶„ì´ì—ˆë‹¤.",
            next: "met_stranger"
        },
        "met_stranger": {
            text: "ê·¸ë¦¬ê³  ê·¸ê³³ì—ì„œ í•œ ì‚¬ëŒì„ ë§Œë‚¬ë‹¤.\n\nì§€ê¸ˆê¹Œì§€ì™€ëŠ” ì „í˜€ ë‹¤ë¥¸ ì‚¶ì„ ì‚´ì•„ê°€ë„ë¡ ì•ˆë‚´í•˜ëŠ” í•œ ì‚¬ëŒì„.",
            next: "stranger_reaction"
        },
        "stranger_reaction": {
            text: "ê·¸ëŸ¬ë‚˜ ì•„ì´ëŠ” ë‚¯ì„ ì‚¬ëŒì˜ ì ‘ê·¼ì— ëª¸ì„ ì›€ì¸ ë ¸ë‹¤.\nì˜¤ë«ë™ì•ˆ ë²½ì„ ì¹˜ê³  ì‚´ì•„ì˜¨ íƒ“ì´ì—ˆë‹¤.",
            next: "gospel_intro"
        },
        "gospel_intro": {
            text: "ê·¸ ì‚¬ëŒì€ â€œë³µìŒâ€ì´ë¼ëŠ” ê²ƒì„ ì „í•´ì£¼ì—ˆë‹¤.\n\ní•˜ì§€ë§Œ ì•„ì´ì˜ ê·€ì—” ë“¤ì–´ì˜¤ì§€ ì•Šì•˜ë‹¤.",
            next: "focus_results"
        },
        "focus_results": {
            text: "ì•„ì´ì˜ ê´€ì‹¬ì€ ë‹¹ì¥ ëˆˆì— ë³´ì´ëŠ” â€œì„±ê³¼â€ì´ì§€,\nì‹¤ì²´ê°€ í™•ì‹¤í•˜ì§€ ì•Šì€ â€œë³µâ€ì´ ì•„ë‹ˆì—ˆë‹¤.",
            next: null // ë°ëª¨ ë
        }
    };

    function renderScene(sceneId) {
        const scene = scenes[sceneId];
        const dialogueBox = document.getElementById('dialogue-text');
        const choiceBox = document.getElementById('choice-container');
        const bgLayer = document.getElementById('bg-layer');

        if (scene.bg && bgImages[scene.bg]) {
            bgLayer.style.backgroundImage = `url('${bgImages[scene.bg]}')`;
            bgLayer.style.opacity = '0.88'; // [í™•ì¸] ì˜¤í¼ì‹œí‹° 88
        } else {
            bgLayer.style.opacity = '0';
            bgLayer.style.backgroundImage = 'none';
        }

        if (scene.type === 'start_trauma') startTraumaEffect();
        if (scene.type === 'stop_trauma') stopTraumaEffect();

        if (scene.isChoice) {
            checkpoint = { sceneId: sceneId, score: currentScore };
        }

        if (scene.score && !scene.isChoice) {
            applyScore(scene.score);
        }

        dialogueBox.innerHTML = '';
        choiceBox.innerHTML = '';

        if (scene.isBadEnd) {
            let delay = 0;
            scene.lines.forEach((line) => {
                const p = document.createElement('div');
                p.innerHTML = line;
                p.className = 'bad-end-line';
                p.style.animationDelay = `${delay}s`;
                dialogueBox.appendChild(p);
                delay += 1.2;
            });
            setTimeout(() => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.innerText = "ì§ì „ ì„ íƒì§€ë¡œ ëŒì•„ê°€ê¸° â†º";
                btn.onclick = () => restoreCheckpoint();
                choiceBox.appendChild(btn);
            }, (scene.lines.length * 1200) + 500);
        } else {
            if (!scene.autoText) dialogueBox.innerHTML = scene.text;

            if (scene.choices) {
                scene.choices.forEach(choice => {
                    const btn = document.createElement('button');
                    btn.className = 'btn';
                    btn.innerText = choice.text;
                    btn.onclick = () => {
                        if (choice.score) applyScore(choice.score);
                        renderScene(choice.next);
                    };
                    choiceBox.appendChild(btn);
                });
            } else if (scene.next) {
                const btn = document.createElement('button');
                btn.className = 'btn next-btn';
                btn.innerText = "ë‹¤ìŒ â–¶";
                btn.onclick = () => {
                    renderScene(scene.next);
                };
                choiceBox.appendChild(btn);
            } else {
                if (sceneId === "end_wandering" || sceneId === "focus_results") {
                    const restartBtn = document.createElement('button');
                    restartBtn.className = 'btn';
                    restartBtn.innerText = "ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°";
                    restartBtn.onclick = () => {
                        currentScore = 0;
                        renderScene('start');
                        updateEnvironment();
                    };
                    choiceBox.appendChild(restartBtn);
                } else {
                    const endTxt = document.createElement('div');
                    endTxt.innerHTML = "<br><i>- To Be Continued -</i>";
                    endTxt.style.opacity = "0.7";
                    choiceBox.appendChild(endTxt);
                }
            }
        }
        updateEnvironment();
    }

    function applyScore(val) {
        currentScore += val;
        showNotification(val);
    }

    function updateEnvironment() {
        let brightness = 5 + (currentScore / 60) * 95;
        if (brightness < 5) brightness = 5;
        if (brightness > 100) brightness = 100;

        const root = document.documentElement;
        root.style.setProperty('--bg-lightness', `${brightness}%`);

        if (brightness > 50) {
            root.style.setProperty('--text-color', '#111111');
            root.style.setProperty('--base-bg-color', '#ffffff');
        } else {
            root.style.setProperty('--text-color', '#f0f0f0');
            root.style.setProperty('--base-bg-color', '#0d0d0d');
        }

        const stageName = getStageName(currentScore);
        document.getElementById('growth-stage').innerText = `${stageName} (${currentScore})`;
    }

    function showNotification(val) {
        const notif = document.getElementById('notif');
        const sign = val > 0 ? '+' : '';
        notif.innerText = `ì„±ì¥ ${sign}${val}`;
        notif.classList.add('show-notif');
        setTimeout(() => notif.classList.remove('show-notif'), 2000);
    }

    function restoreCheckpoint() {
        currentScore = checkpoint.score;
        renderScene(checkpoint.sceneId);
        updateEnvironment();
    }

    function startTraumaEffect() {
        if (traumaInterval) return;
        const words = [
            {t: "ì•¼! ë–¨ì–´ì ¸! ëƒ„ìƒˆë‚˜!", c: ""}, {t: "ì™„ì „ ìŒì¹¨í•´!", c: ""},
            {t: "ì™œ íƒœì–´ë‚¬ì–´?", c: "red"}, {t: "ì£½ì–´ë²„ë ¤", c: "red"},
            {t: "ë„ˆ ê°™ì€ ê±´ ì“¸ëª¨ì—†ì–´", c: "red"}, {t: "ê³µê¸°ì•„ê¹Œì›Œ", c: "red"},
            {t: "ë©ì²­ì´", c: ""}, {t: "ì‚¬ë¼ì ¸", c: "red"}
        ];
        traumaInterval = setInterval(() => {
            const w = words[Math.floor(Math.random() * words.length)];
            const span = document.createElement('span');
            span.className = 'trauma-word';
            if (w.c === 'red') span.classList.add('trauma-red');
            span.innerText = w.t;
            const fontSize = Math.random() * 1.5 + 1;
            span.style.fontSize = fontSize + "rem";
            span.style.left = Math.random() * 80 + 10 + "%";
            span.style.top = Math.random() * 80 + 10 + "%";
            span.style.transform = `rotate(${Math.random() * 60 - 30}deg)`;
            document.body.appendChild(span);
            setTimeout(() => span.remove(), 600);
        }, 100);
    }

    function stopTraumaEffect() {
        if (traumaInterval) {
            clearInterval(traumaInterval);
            traumaInterval = null;
        }
        document.querySelectorAll('.trauma-word').forEach(e => e.remove());
    }

    renderScene('start');
    updateEnvironment();
</script>
</body>
</html>
